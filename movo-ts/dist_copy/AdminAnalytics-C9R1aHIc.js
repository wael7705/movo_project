import{c as f,r as a,l as j,a as v,b as x,j as e,M as b,T as N,d as p,e as y,f as w}from"./index-O68NxAnm.js";import{a as k,t as C,b as R}from"./api-CgcxiNEu.js";const g=f(function(l,n){const s=new j.Tooltip(l,n.overlayContainer);return v(s,n)},function(l,n,{position:s},d){a.useEffect(function(){const o=n.overlayContainer;if(o==null)return;const{instance:u}=l,t=m=>{m.tooltip===u&&(s!=null&&u.setLatLng(s),u.update(),d(!0))},i=m=>{m.tooltip===u&&d(!1)};return o.on({tooltipopen:t,tooltipclose:i}),o.bindTooltip(u),function(){o.off({tooltipopen:t,tooltipclose:i}),o._map!=null&&o.unbindTooltip()}},[l,n,d,s])}),T=a.forwardRef(function({captains:l=[],restaurants:n=[],customers:s=[]},d){const c=a.useRef(null),o=a.useRef({}),u=a.useMemo(()=>{const t=[...l,...n,...s];return t.length>0?{lat:t[0].lat,lng:t[0].lng}:{lat:33.5138,lng:36.2765}},[l,n,s]);return a.useImperativeHandle(d,()=>({highlightCaptain:t=>{c.current=t;const i=o.current[String(t)];i&&i.setIcon(x(!0))}})),a.useEffect(()=>{const t=c.current;if(!t)return;const i=o.current[String(t)];i&&i.setIcon(x(!0))},[l]),e.jsx("div",{className:"w-full h-[420px] rounded-xl overflow-hidden border",children:e.jsxs(b,{center:u,zoom:13,style:{width:"100%",height:"100%"},children:[e.jsx(N,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),n.map(t=>e.jsx(p,{position:[t.lat,t.lng],icon:y,children:e.jsx(g,{children:t.name})},`rest-${t.id}`)),s.map(t=>e.jsx(p,{position:[t.lat,t.lng],icon:w,children:e.jsx(g,{children:t.name})},`cust-${t.id}`)),l.map(t=>e.jsx(p,{position:[t.lat,t.lng],icon:x(String(c.current)===String(t.id)),ref:i=>{i&&(o.current[String(t.id)]=i.leafletElement??i)},children:e.jsx(g,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsxs("div",{children:["Status: ",t.status??"active"]}),e.jsxs("div",{children:["Orders now: ",t.orders_now??0]}),typeof t.rating=="number"&&e.jsxs("div",{children:["Rating: ",t.rating.toFixed(1),"⭐"]})]})})},`cap-${t.id}`))]})})});function z(){const[r,l]=a.useState("restaurants");return e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 flex gap-2",children:[{k:"restaurants",l:"Restaurants"},{k:"captains",l:"Captains"},{k:"employees",l:"Employees"}].map(n=>e.jsx("button",{onClick:()=>l(n.k),className:`px-3 py-2 rounded-lg ${r===n.k?"bg-violet-600 text-white":"bg-white border hover:bg-zinc-50"}`,children:n.l},n.k))}),r==="restaurants"&&e.jsx(S,{}),r==="captains"&&e.jsx(I,{}),r==="employees"&&e.jsx("div",{className:"p-6 bg-white border rounded-xl",children:"Coming soon…"})]})}function S(){const[r,l]=a.useState([]),[n,s]=a.useState(null),[d,c]=a.useState(!1);a.useEffect(()=>{let t=!0;return c(!0),k().then(i=>t&&l(i||[])).finally(()=>t&&c(!1)),()=>{t=!1}},[]);const o=a.useMemo(()=>r.find(t=>t.id===n)||null,[r,n]),u=async(t,i)=>{await C(t.id,i),l(m=>m.map(h=>h.id===t.id?{...h,visible:i}:h))};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white border rounded-xl",children:[d&&e.jsx("div",{className:"p-4 text-zinc-500",children:"Loading…"}),!d&&e.jsx("ul",{className:"divide-y",children:r.map(t=>e.jsxs("li",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{className:"font-semibold hover:underline",onClick:()=>s(t.id),children:t.name}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!t.visible,onChange:i=>u(t,i.target.checked)}),"Visible"]})]}),n===t.id&&e.jsxs("div",{className:"mt-3 text-sm text-zinc-600",children:[e.jsx("div",{children:"Categories… (placeholder, implement like restaurant toggle)"}),e.jsx("div",{children:"Addons… (placeholder, implement like category toggle)"})]})]},t.id))})]})}),e.jsx("div",{children:e.jsxs("div",{className:"p-4 bg-white border rounded-xl",children:[e.jsx("div",{className:"font-semibold mb-3",children:"KPIs"}),o?e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsx("div",{children:"Rating: —"}),e.jsx("div",{children:"Orders today: —"}),e.jsx("div",{children:"Orders this week: —"}),e.jsx("div",{children:"Profit margin: —"})]}):e.jsx("div",{className:"text-zinc-500 text-sm",children:"Select a restaurant…"})]})})]})}function I(){const[r,l]=a.useState([]),n=a.useRef(null);return a.useEffect(()=>{let s=!0,d;const c=async()=>{try{const o=await R();s&&l(o||[])}catch{}};return c(),d=setInterval(c,5e3),()=>{s=!1,clearInterval(d)}},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{ref:n,captains:r}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:r.map(s=>e.jsxs("div",{className:"bg-white border rounded-xl p-4 hover:shadow transition",onMouseEnter:()=>n.current?.highlightCaptain(s.id),children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs("div",{className:"text-sm text-zinc-600",children:["ID: ",s.id," • Vehicle: ",s.vehicle||"—"]}),e.jsxs("div",{className:"text-sm",children:["Active: ",s.status==="offline"?"No":"Yes"]}),e.jsxs("div",{className:"text-sm",children:["Current Orders: ",s.orders_now??0]}),e.jsxs("div",{className:"text-sm",children:["Delivered Today: ",s.delivered_today??0]}),e.jsxs("div",{className:"text-sm",children:["Rating: ",typeof s.rating=="number"?s.rating.toFixed(1):"—","⭐"]})]},s.id))})]})}export{z as default};
